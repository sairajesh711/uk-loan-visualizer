<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UK Loan Visualiser — MVP Shell</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    :root {
      --bg: #0b0c0e;
      --panel: #14161a;
      --muted: #6b7280;
      --text: #e5e7eb;
      --accent: #60a5fa;
      --border: #23262b;
      --card: #111315;
      --radius: 14px;
      --gap: 14px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text); background: radial-gradient(1200px 800px at 80% -10%, #1a2230 0%, #0b0c0e 60%) no-repeat, var(--bg);
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px 18px 56px; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; }
    h1 { font-size: 20px; margin: 0; letter-spacing: 0.3px; }
    .grid {
      display: grid; grid-template-columns: 1.1fr 1fr; gap: 18px;
    }
    @media (max-width: 980px) { .grid { grid-template-columns: 1fr; } }
    .panel {
      background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); padding: 18px;
      box-shadow: 0 8px 20px rgba(0,0,0,.35);
    }
    .panel h2 { margin: 0 0 12px; font-size: 16px; color: #cbd5e1; }
    .muted { color: var(--muted); font-size: 13px; }

    /* Form */
    form { display: grid; gap: 14px; }
    .field { display: grid; gap: 6px; }
    .row { display: grid; gap: 12px; grid-template-columns: 1fr 1fr; }
    @media (max-width: 620px) { .row { grid-template-columns: 1fr; } }
    label { font-size: 13px; color: #cbd5e1; }
    input[type="number"], input[type="text"], select {
      appearance: none;
      width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border);
      background: #0f1114; color: var(--text); outline: none;
    }
    input::placeholder { color: #616875; }
    .help { font-size: 12px; color: var(--muted); }

    /* Segmented toggle */
    .seg {
      display: inline-grid; grid-auto-flow: column; gap: 8px; background: #0f1114; padding: 6px; border-radius: 999px; border: 1px solid var(--border);
      width: max-content;
    }
    .seg input { display: none; }
    .seg label {
      padding: 8px 12px; border-radius: 999px; cursor: pointer; user-select: none; font-size: 13px; color: #cbd5e1;
      border: 1px solid transparent;
    }
    .seg input:checked + label {
      background: linear-gradient(180deg, #1a2430, #131820);
      border-color: #273041;
      color: #e8eef9;
      box-shadow: inset 0 0 0 1px rgba(96,165,250,.2);
    }

    /* Range slider */
    .range { display: grid; gap: 6px; }
    input[type="range"] {
      width: 100%;
      accent-color: var(--accent);
    }
    .range-head { display: flex; justify-content: space-between; align-items: baseline; }
    .range .value {
      font-variant-numeric: tabular-nums;
      color: #d1e0ff; font-size: 14px;
    }

    /* Results placeholders */
    .results {
      display: grid; gap: 12px;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    @media (max-width: 620px) { .results { grid-template-columns: 1fr; } }
    .card {
      background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 14px;
      min-height: 88px; display: grid; align-content: start; gap: 8px;
    }
    .eyebrow { font-size: 12px; color: var(--muted); letter-spacing: .3px; text-transform: uppercase; }
    .big { font-size: 22px; letter-spacing: .2px; }
    .dash { color: #7a8291; }

    /* Placeholder chart block */
    .chart {
      background: #0f1114; border: 1px dashed #2a2f37; border-radius: 12px; height: 220px;
      display: grid; place-items: center; color: #8b95a7; font-size: 13px;
    }

    .banner {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 14px;
      margin: 12px 0 18px;
      display: grid;
      gap: 6px;
    }
    .banner.error {
      background: #1b1112;      /* subtle red-ish on your dark theme */
      border-color: #3a1719;
      color: #f8d7da;
    }
    .hidden { display: none !important; }
  </style>
</head>
<body data-bs-theme="dark">
  <div class="container">
    <header>
      <h1>UK Loan Visualiser</h1>
      <div aria-live="polite" class="muted">Commit 3: Now with live calculations! Engine connected.</div>
    </header>

    <div id="statusPill" class="muted" style="font-size:12px;margin:6px 0 12px;">
      Engine: <span id="statusText">loading…</span>
    </div>

    <div id="errorBanner" class="alert alert-danger d-none" role="alert" aria-live="assertive">
      <strong>Check your inputs</strong>
      <div id="errorText" class="small opacity-75">—</div>
    </div>

    <main class="grid" role="main">
      <!-- Left: Inputs -->
      <section class="panel sticky-top" style="top: 16px;" aria-label="Loan Inputs">
        <h2>Loan inputs</h2>

        <!-- Loan type toggle (segmented) -->
        <fieldset aria-label="Loan Type">
          <legend class="muted">Loan type</legend>
          <div class="seg" role="tablist" aria-label="Loan Type Toggle">
            <input id="loanType-mortgage" name="loanType" type="radio" value="mortgage" checked />
            <label for="loanType-mortgage" role="tab" aria-selected="true">Mortgage</label>

            <input id="loanType-personal" name="loanType" type="radio" value="personal" />
            <label for="loanType-personal" role="tab" aria-selected="false">Personal Loan</label>
          </div>
          
          <div class="mt-2 d-flex flex-wrap gap-2">
            <button type="button" class="btn btn-sm btn-outline-secondary" id="preset-mortgage">Typical Mortgage</button>
            <button type="button" class="btn btn-sm btn-outline-secondary" id="preset-personal">Typical Personal Loan</button>
          </div>
        </fieldset>

        <form aria-describedby="formHelp" autocomplete="off">
          <p id="formHelp" class="help">These fields describe your <em>existing</em> loan. Calculations update live as you type.</p>

          <div class="field mb-3">
            <label for="outstandingBalance" class="form-label">Outstanding Balance (£)</label>
            <input id="outstandingBalance" name="outstandingBalance" min="1" type="number" inputmode="decimal" placeholder="250000" class="form-control" aria-describedby="outstandingHelp" />
            <div id="outstandingHelp" class="form-text">Remaining principal today (e.g., 250000).</div>
          </div>

          <div class="row">
            <div class="field mb-3">
              <label for="remainingTermMonths" class="form-label">Remaining Term (months)</label>
              <input id="remainingTermMonths" name="remainingTermMonths" min="1" type="number" inputmode="numeric" placeholder="300" class="form-control" aria-describedby="termHelp" />
              <div id="termHelp" class="form-text">Months left on the loan (e.g., 300 = 25 years).</div>
            </div>

            <div class="field mb-3">
              <label for="interestApr" class="form-label">Interest Rate (APR %)</label>
              <input id="interestApr" name="interestApr" type="number" inputmode="decimal" placeholder="4.25" min="0" step="0.01" class="form-control" aria-describedby="aprHelp" />
              <div id="aprHelp" class="form-text">Annual Percentage Rate (e.g., 4.25).</div>
            </div>
          </div>

          <div class="field range mb-3">
            <div class="d-flex justify-content-between align-items-baseline">
              <label for="overpayMonthly" class="form-label mb-1">Monthly Overpayment (£)</label>
              <span class="value" id="overpayValue" aria-live="polite">£0</span>
            </div>
            <input id="overpayMonthly" name="overpayMonthly" type="range" min="0" max="5000" step="50" value="0" class="form-range" />
            <div class="form-text">Adjust how much extra you might pay each month.</div>
          </div>

          <div class="field range mb-2">
            <div class="d-flex justify-content-between align-items-baseline">
              <label for="expectedReturn" class="form-label mb-1">Expected Annual Return (%)</label>
              <span class="value" id="expectedReturnValue" aria-live="polite">4.0%</span>
            </div>
            <input id="expectedReturn" name="expectedReturn" type="range" min="0" max="15" step="0.1" value="4.0" class="form-range" />
            <div class="form-text">
              Recommended (deposit / risk-free proxy): <span id="recommendedRate">4.0%</span>
            </div>
          </div>
        </form>
      </section>

      <!-- Right: Results, Charts, and Compare -->
      <section class="panel" aria-label="Results">
        <h2>Results</h2>

        <div class="results" aria-live="polite">
          <div class="card">
            <div class="eyebrow">Projected Payoff Date</div>
            <div class="big dash" id="result-payoffDate">—</div>
            <div class="help">When the loan would finish with the chosen overpayment.</div>
          </div>

          <div class="card">
            <div class="eyebrow">Interest Saved vs No Overpayment</div>
            <div class="big dash" id="result-interestSaved">—</div>
            <div class="help">Total £ saved in interest compared to baseline.</div>
          </div>

          <div class="card">
            <div class="eyebrow">Total Interest (with Overpayment)</div>
            <div class="big dash" id="result-totalInterest">—</div>
            <div class="help">Cumulative interest paid under the current inputs.</div>
          </div>

          <div class="card">
            <div class="eyebrow">Months Saved</div>
            <div class="big dash" id="result-monthsSaved">—</div>
            <div class="help">How many months earlier you finish vs baseline.</div>
          </div>

          <div class="card">
            <div class="eyebrow">If Invested Instead (by original payoff date)</div>
            <div class="big dash" id="result-fvInvest">—</div>
            <div class="help">Value if you invested the monthly overpayment until the original payoff date.</div>
          </div>

          <div class="card">
            <div class="eyebrow">Δ Invest − Overpay (simple)</div>
            <div class="big dash" id="result-deltaSimple">—</div>
            <div class="help">Positive means investing beats overpaying (simple horizon).</div>
          </div>
        </div>

        <!-- Keeping charts nested so they remain in the right column without grid refactor -->
        <div class="panel" aria-label="Loan Analysis" style="margin-top:18px">
          <h2>Loan Balance & Interest</h2>
          <div class="chart" role="img" aria-label="Balance over time">
            <div class="ratio ratio-16x9 w-100">
              <canvas id="balanceChart"></canvas>
            </div>
          </div>
          <div class="chart" role="img" aria-label="Monthly interest comparison" style="margin-top:12px">
            <div class="ratio ratio-21x9 w-100">
              <canvas id="interestBarChart"></canvas>
            </div>
          </div>
        </div>

        <div class="panel" aria-label="Investment Analysis" style="margin-top:18px">
          <h2>Investment vs Overpayment Analysis</h2>
          <div class="chart" role="img" aria-label="Cumulative returns over time">
            <div class="ratio ratio-16x9 w-100">
              <canvas id="oppLineChart"></canvas>
            </div>
          </div>
          <div class="chart" role="img" aria-label="Final value comparison" style="margin-top:12px">
            <div class="ratio ratio-21x9 w-100">
              <canvas id="oppBarChart"></canvas>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="muted" style="margin-top:18px">
      v0.6 — Investment analysis! Compare overpaying vs investing with expected return calculations.
    </footer>
  </div>

  <!-- libs first, then app -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="./main.js"></script>
</body>
</html>
